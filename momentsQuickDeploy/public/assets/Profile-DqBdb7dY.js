import{h as N,c as u,a as t,o as m,u as T,g as E,q as U,s as w,m as l,n as L,b as i,w as v,I as f,k as b,x as c,E as y,G as k,d as x,t as C,H as M,J as j,K as z,_ as R}from"./index-DC8TisQv.js";import{C as q}from"./ChevronLeft-BjDTB2Cn.js";const A={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 320 512"},g=N({name:"ChevronRight",render:function(d,r){return m(),u("svg",A,r[0]||(r[0]=[t("path",{d:"M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256L34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z",fill:"currentColor"},null,-1)]))}}),G={class:"container"},H={class:"header"},J={class:"body"},K={class:"body-item-right"},h=["src"],F={key:0,class:"input"},O={class:"body-item-right"},Q=["src"],W={key:1,class:"input"},X={class:"body-item-right"},Y={key:2,class:"input"},Z={class:"body-item-right"},_={key:3,class:"input"},ee={class:"body-item-right"},te={key:4,class:"input"},se={class:"body-item-right"},oe={key:5,class:"input"},ae={class:"body-item-right"},le={key:6,class:"input"},ne={class:"body-item-right"},ie={key:7,class:"input"},re={class:"body-item-right"},de={key:8,class:"input"},ue=N({__name:"Profile",setup(S){const d=T(),r=E(),o=U({avatar:!1,header_background:!1,role:!1,status:!1,nickname:!1,username:!1,email:!1,brief:!1,password:!1}),n=U({avatar:w(()=>d.profile?.avatar??"/img/avatar.jpg"),header_background:w(()=>d.profile?.header_background??"/img/header.jpg"),role:w(()=>Number(d.profile?.role)===1?"管理员":"用户"),status:w(()=>Number(d.profile?.status)===1?"正常":"异常"),nickname:w(()=>d.profile?.nickname??"未设置"),username:w(()=>d.profile?.username),email:w(()=>d.profile?.email??"未绑定"),brief:w(()=>d.profile?.brief??"未设置")}),a=U({avatar:"",header_background:"",nickname:"",email:"",brief:"",oldPassword:"",newPassword:""}),P=U({avatar:!1,header_background:!1,nickname:!1,email:!1,brief:!1,status:!1});async function $(p,e){if(P[p])return;if(e===n[p]){r.show("内容未作修改","info",2e3);return}const s={[p]:e},V=r.show("正在修改中","loading");try{P[p]=!0,await M(s),await d.fetchUserProfile(),r.update(V,{text:"更新成功",type:"success",duration:2e3}),p in o&&(o[p]=!1)}catch(I){console.error("更新信息失败，请稍后重试",I),r.update(V,{text:"更新信息失败，请稍后重试",type:"error",duration:2e3})}finally{P[p]=!1,setTimeout(()=>{r.close(V)},2e3)}}const B=async p=>{const e=r.show("正在更新密码","loading");try{(await j(p)).data.status?r.update(e,{text:"更新密码成功",type:"success",duration:2e3}):r.update(e,{text:"更新密码失败",type:"error",duration:2e3})}catch(s){z(s)&&s.response?r.update(e,{text:`${s.response.data.message}`,type:"error",duration:2e3}):r.update(e,{text:"发生未知错误",type:"error",duration:2e3})}};function D(){d.handleLogout(),r.show("已退出登录","success",2e3),L.replace("/")}return(p,e)=>(m(),u("div",G,[t("div",H,[t("div",{id:"back",onClick:e[0]||(e[0]=s=>l(L).back())},[i(l(f),null,{default:v(()=>[i(l(q))]),_:1})]),e[27]||(e[27]=t("div",null,"用户资料",-1))]),t("div",J,[t("div",{class:"body-item",onClick:e[1]||(e[1]=s=>{a.avatar=n.avatar,o.avatar=!o.avatar})},[e[28]||(e[28]=t("div",{class:"body-item-left"},"头像",-1)),t("div",K,[t("img",{src:n.avatar,alt:"avatar",style:{width:"35px"}},null,8,h),i(l(f),{class:c(["icon",{"rotate-icon":o.avatar}])},{default:v(()=>[i(l(g))]),_:1},8,["class"])])]),o.avatar?(m(),u("div",F,[y(t("input",{type:"text",placeholder:"请输入 新头像url","onUpdate:modelValue":e[2]||(e[2]=s=>a.avatar=s)},null,512),[[k,a.avatar]]),t("button",{onClick:e[3]||(e[3]=s=>$("avatar",a.avatar))},"更新")])):b("",!0),t("div",{class:"body-item",onClick:e[4]||(e[4]=s=>{a.header_background=n.header_background,o.header_background=!o.header_background})},[e[29]||(e[29]=t("div",{class:"body-item-left"},"背景",-1)),t("div",O,[t("img",{src:n.header_background,alt:"不支持视频",style:{width:"60px"}},null,8,Q),i(l(f),{class:c(["icon",{"rotate-icon":o.avatar}])},{default:v(()=>[i(l(g))]),_:1},8,["class"])])]),o.header_background?(m(),u("div",W,[y(t("input",{type:"text",placeholder:"请输入 新背景url","onUpdate:modelValue":e[5]||(e[5]=s=>a.header_background=s)},null,512),[[k,a.header_background]]),t("button",{onClick:e[6]||(e[6]=s=>$("header_background",a.header_background))},"更新")])):b("",!0),t("div",{class:"body-item",onClick:e[7]||(e[7]=s=>o.role=!o.role)},[e[30]||(e[30]=t("div",{class:"body-item-left"},"角色",-1)),t("div",X,[x(C(n.role)+" ",1),i(l(f),{class:c(["icon",{"rotate-icon":o.role}])},{default:v(()=>[i(l(g))]),_:1},8,["class"])])]),o.role?(m(),u("div",Y,[y(t("input",{type:"text",placeholder:"请输入 角色",readonly:"","onUpdate:modelValue":e[8]||(e[8]=s=>n.username=s),style:{color:"#00000098"}},null,512),[[k,n.username]]),e[31]||(e[31]=t("button",{style:{background:"#00000098"}},"不可更改",-1))])):b("",!0),t("div",{class:"body-item",onClick:e[9]||(e[9]=s=>o.status=!o.status)},[e[32]||(e[32]=t("div",{class:"body-item-left"},"状态",-1)),t("div",Z,[x(C(n.status)+" ",1),i(l(f),{class:c(["icon",{"rotate-icon":o.status}])},{default:v(()=>[i(l(g))]),_:1},8,["class"])])]),o.status?(m(),u("div",_,[y(t("input",{type:"text",placeholder:"请输入 状态码",readonly:"","onUpdate:modelValue":e[10]||(e[10]=s=>n.status=s),style:{color:"#00000098"}},null,512),[[k,n.status]]),e[33]||(e[33]=t("button",{style:{background:"#00000098"}},"不可更改",-1))])):b("",!0),t("div",{class:"body-item",onClick:e[11]||(e[11]=s=>{a.nickname=n.nickname,o.nickname=!o.nickname})},[e[34]||(e[34]=t("div",{class:"body-item-left"},"昵称",-1)),t("div",ee,[x(C(n.nickname)+" ",1),i(l(f),{class:c(["icon",{"rotate-icon":o.nickname}])},{default:v(()=>[i(l(g))]),_:1},8,["class"])])]),o.nickname?(m(),u("div",te,[y(t("input",{type:"text",placeholder:"请输入 新昵称","onUpdate:modelValue":e[12]||(e[12]=s=>a.nickname=s)},null,512),[[k,a.nickname]]),t("button",{onClick:e[13]||(e[13]=s=>$("nickname",a.nickname))},"更新")])):b("",!0),t("div",{class:"body-item",onClick:e[14]||(e[14]=s=>o.username=!o.username)},[e[35]||(e[35]=t("div",{class:"body-item-left"},"账号",-1)),t("div",se,[x(C(n.username)+" ",1),i(l(f),{class:c(["icon",{"rotate-icon":o.username}])},{default:v(()=>[i(l(g))]),_:1},8,["class"])])]),o.username?(m(),u("div",oe,[y(t("input",{type:"text",placeholder:"请输入 用户名",readonly:"","onUpdate:modelValue":e[15]||(e[15]=s=>n.username=s),style:{color:"#00000098"}},null,512),[[k,n.username]]),e[36]||(e[36]=t("button",{style:{background:"#00000098"}},"不可更改",-1))])):b("",!0),t("div",{class:"body-item",onClick:e[16]||(e[16]=s=>o.password=!o.password)},[e[38]||(e[38]=t("div",{class:"body-item-left"},"密码",-1)),t("div",ae,[e[37]||(e[37]=t("span",null,"需提供新旧密码",-1)),i(l(f),{class:c(["icon",{"rotate-icon":o.password}])},{default:v(()=>[i(l(g))]),_:1},8,["class"])])]),o.password?(m(),u("div",le,[y(t("input",{type:"text",placeholder:"请输入 旧密码","onUpdate:modelValue":e[17]||(e[17]=s=>a.oldPassword=s)},null,512),[[k,a.oldPassword]]),y(t("input",{type:"text",placeholder:"请输入 新密码","onUpdate:modelValue":e[18]||(e[18]=s=>a.newPassword=s)},null,512),[[k,a.newPassword]]),t("button",{onClick:e[19]||(e[19]=s=>B({oldPassword:a.oldPassword,newPassword:a.newPassword}))},"更新")])):b("",!0),t("div",{class:"body-item",onClick:e[20]||(e[20]=s=>{a.email=n.email,o.email=!o.email})},[e[39]||(e[39]=t("div",{class:"body-item-left"},"邮箱",-1)),t("div",ne,[x(C(n.email)+" ",1),i(l(f),{class:c(["icon",{"rotate-icon":o.email}])},{default:v(()=>[i(l(g))]),_:1},8,["class"])])]),o.email?(m(),u("div",ie,[y(t("input",{type:"text",placeholder:"请输入 邮箱","onUpdate:modelValue":e[21]||(e[21]=s=>a.email=s)},null,512),[[k,a.email]]),t("button",{onClick:e[22]||(e[22]=s=>$("email",a.email))},"更新")])):b("",!0),t("div",{class:"body-item",onClick:e[23]||(e[23]=s=>{a.brief=n.brief,o.brief=!o.brief})},[e[40]||(e[40]=t("div",{class:"body-item-left"},"签名",-1)),t("div",re,[x(C(n.brief)+" ",1),i(l(f),{class:c(["icon",{"rotate-icon":o.brief}])},{default:v(()=>[i(l(g))]),_:1},8,["class"])])]),o.brief?(m(),u("div",de,[y(t("input",{type:"text",placeholder:"请输入 签名","onUpdate:modelValue":e[24]||(e[24]=s=>a.brief=s)},null,512),[[k,a.brief]]),t("button",{onClick:e[25]||(e[25]=s=>$("brief",a.brief))},"更新")])):b("",!0),l(d).profile?.role=="1"?(m(),u("div",{key:9,class:"body-backend",onClick:e[26]||(e[26]=s=>l(L).push({name:"admin"}))},e[41]||(e[41]=[t("div",null,"进入后台",-1)]))):b("",!0),t("div",{class:"body-logout",onClick:D},e[42]||(e[42]=[t("div",null,"退出登录",-1)]))])]))}}),ve=R(ue,[["__scopeId","data-v-7cebb8ac"]]);export{ve as default};
