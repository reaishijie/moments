import{h as Z,f as p,s as q,g as J,c as r,a as l,k as h,D as U,d as y,E as d,G as f,V as z,F as x,l as $,t as u,T as B,o as v,x as T,_ as K}from"./index-DC8TisQv.js";import{c as O,u as Q,f as R}from"./articles-kPCKrvUi.js";const W={class:"top"},X={for:"id",title:"文章ID"},Y={for:"user_id",title:"用户ID"},ee={for:"content",title:"文章内容"},le={for:"location",title:"位置"},te={for:"type",title:"文章类型"},oe={class:"list"},ae={class:"table-wrapper"},se=["title"],ne=["src"],ie=["onClick"],ue=["onClick"],de={class:"pagination-wrapper"},re={class:"pagination-info"},ve={key:0,class:"pagination"},pe=["disabled"],ce={key:0,class:"pagination-ellipsis"},fe=["onClick"],ge=["disabled"],be={class:"modal-body"},me={class:"edit-form"},ye={class:"form-group full-width"},ke={class:"form-group full-width"},Ce={class:"form-row"},he={class:"form-group"},we={class:"form-group"},_e={class:"checkbox-group"},xe={class:"checkbox-label"},Ie={class:"checkbox-label"},Se={key:0,class:"form-group full-width"},Ve={key:1,class:"form-group full-width"},De={class:"modal-actions"},Ae=["disabled"],Ue={class:"confirm-header"},ze={class:"confirm-body"},Te={class:"confirm-actions"},Me=Z({__name:"Article",setup(Ee){const M={articleId:"",userId:"",content:"",location:"",type:-1,is_top:!1,is_ad:!1},n=p({...M}),E=p([]),i=p({page:1,pageSize:5,total:0}),N=()=>{n.value={...M},i.value.page=1,g()},g=async()=>{const o={page:i.value.page,pageSize:i.value.pageSize};n.value.articleId&&(o.articleId=Number(n.value.articleId)),n.value.userId&&(o.userId=Number(n.value.userId)),n.value.content&&(o.content=n.value.content),n.value.location&&(o.location=n.value.location),n.value.type!==-1&&(o.type=n.value.type),n.value.isTop&&(o.isTop=n.value.isTop),n.value.isAd&&(o.isAd=n.value.isAd);const e=await O(o);E.value=e.data.data,i.value={page:e.data.page,pageSize:e.data.pageSize,total:e.data.total}},I=o=>{i.value.page=o,g()},F=o=>{i.value.pageSize=o,i.value.page=1,g()},S=q(()=>Math.ceil(i.value.total/i.value.pageSize)),P=()=>{const o=i.value.page,e=S.value,t=[];if(e<=7)for(let a=1;a<=e;a++)t.push(a);else if(t.push(1),o<=4){for(let a=2;a<=5;a++)t.push(a);t.push("..."),t.push(e)}else if(o>=e-3){t.push("...");for(let a=e-4;a<=e;a++)a>1&&t.push(a)}else{t.push("...");for(let a=o-1;a<=o+1;a++)t.push(a);t.push("..."),t.push(e)}return t},c=J(),w=p(null),V=p(!1),s=p({}),b=p(""),m=p(""),k=p({saving:!1}),D=p(!1),C=p({title:"",message:"",onConfirm:()=>{},onCancel:()=>{}}),j=(o,e,t,a)=>{C.value={title:o,message:e,onConfirm:t,onCancel:()=>{}},D.value=!0},A=()=>{D.value=!1},G=async o=>{j("确认删除","确定要删除这篇文章吗？此操作不可恢复！",async()=>{const e=c.show("正在删除文章...","loading");try{await R(o),c.update(e,{text:"文章删除成功！",type:"success",duration:2e3}),g(),A()}catch(t){console.error("删除文章失败:",t),c.update(e,{text:"删除失败，请稍后重试",type:"error",duration:3e3})}})},H=o=>{w.value=o,s.value={content:o.content,type:o.type,location:o.location,isTop:o.is_top,isAd:o.is_ad},o.article_images&&o.article_images.length>0?b.value=o.article_images.map(e=>e.image_url).join(`
`):b.value="",o.article_videos&&o.article_videos.length>0?m.value=o.article_videos.map(e=>e.video_url||e.url||"").filter(Boolean).join(`
`):m.value="",V.value=!0},_=()=>{V.value=!1,w.value=null,s.value={},b.value="",m.value="",k.value.saving=!1},L=async()=>{if(!w.value)return;if(!s.value.content&&!b.value?.trim()&&!m.value?.trim()){c.show("文章内容不能为空","info",2e3);return}if(k.value.saving){c.show("请勿重复点击","info",2e3);return}const o=c.show("正在更新文章...","loading");k.value.saving=!0;try{const e={};if(s.value.content&&(e.content=s.value.content),s.value.type!==void 0&&(e.type=s.value.type),s.value.location&&(e.location=s.value.location),s.value.isTop!==void 0&&(e.isTop=s.value.isTop),s.value.isAd!==void 0&&(e.isAd=s.value.isAd),s.value.type==1){const t=b.value.split(/[\s,]+|[\n]+/).map(a=>a.trim()).filter(a=>a);e.imageUrls=t}if(s.value.type==2){const t=m.value.split(/[\s,]+|[\n]+/).map(a=>a.trim()).filter(a=>a);e.videoUrls=t}await Q(w.value.id,e),_(),g(),c.update(o,{text:"文章更新成功！",type:"success",duration:2e3})}catch(e){console.error("更新文章失败:",e),c.update(o,{text:"更新失败，请稍后重试",type:"error",duration:3e3})}finally{k.value.saving=!1}};return g(),(o,e)=>(v(),r(x,null,[l("div",W,[l("form",{onSubmit:U(g,["prevent"])},[l("label",X,[e[19]||(e[19]=y("文章ID： ")),d(l("input",{type:"number",id:"id",placeholder:"文章ID","onUpdate:modelValue":e[0]||(e[0]=t=>n.value.articleId=t)},null,512),[[f,n.value.articleId]])]),l("label",Y,[e[20]||(e[20]=y("用户ID： ")),d(l("input",{type:"number",id:"user_id",placeholder:"用户ID","onUpdate:modelValue":e[1]||(e[1]=t=>n.value.userId=t)},null,512),[[f,n.value.userId]])]),l("label",ee,[e[21]||(e[21]=y("文章内容： ")),d(l("input",{type:"text",id:"content",placeholder:"文章内容(支持模糊查询)","onUpdate:modelValue":e[2]||(e[2]=t=>n.value.content=t)},null,512),[[f,n.value.content]])]),l("label",le,[e[22]||(e[22]=y("位置： ")),d(l("input",{type:"text",id:"location",placeholder:"位置(支持模糊查询)","onUpdate:modelValue":e[3]||(e[3]=t=>n.value.location=t)},null,512),[[f,n.value.location]])]),l("label",te,[e[24]||(e[24]=y("文章类型： ")),d(l("select",{name:"articleType",id:"type","onUpdate:modelValue":e[4]||(e[4]=t=>n.value.type=t)},e[23]||(e[23]=[l("option",{value:"-1"},"请选择",-1),l("option",{value:"0"},"普通",-1),l("option",{value:"1"},"图文",-1),l("option",{value:"2"},"视频",-1)]),512),[[z,n.value.type]])]),e[25]||(e[25]=l("button",{type:"submit"},"查询",-1)),l("button",{type:"button",onClick:N},"重置")],32)]),l("div",oe,[l("div",ae,[l("table",null,[e[26]||(e[26]=l("thead",null,[l("tr",null,[l("th",null,"ID"),l("th",null,"用户"),l("th",null,"内容"),l("th",null,"类型"),l("th",null,"置顶"),l("th",null,"广告"),l("th",null,"评论/点赞"),l("th",null,"发布时间"),l("th",null,"操作")])],-1)),l("tbody",null,[(v(!0),r(x,null,$(E.value,t=>(v(),r("tr",{key:t.id},[l("td",null,u(t.id),1),l("td",null,[l("div",{class:"user-cell",title:"用户id："+t.user.id},[l("img",{src:t.user.avatar,alt:""},null,8,ne),l("i",null,"@"+u(t.user.username),1)],8,se)]),l("td",null,u(t.content.slice(0,50))+u(t.content.length>50?"...":""),1),l("td",null,u(["普通","图文","视频"][t.type]),1),l("td",null,[l("span",{class:T(["badge",t.is_top?"badge-true":"badge-false"])},u(t.is_top?"是":"否"),3)]),l("td",null,[l("span",{class:T(["badge",t.is_ad?"badge-true":"badge-false"])},u(t.is_ad?"是":"否"),3)]),l("td",null,u(t.comment_count)+"/"+u(t.like_count),1),l("td",null,u(t.created_at),1),l("td",null,[l("button",{onClick:a=>H(t),class:"edit-btn"},"编辑",8,ie),l("button",{onClick:a=>G(t.id.toString()),class:"delete-btn"},"删除",8,ue)])]))),128))])])]),l("div",de,[l("div",re,[l("span",null,"共 "+u(i.value.total)+" 条记录",1),d(l("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>i.value.pageSize=t),onChange:e[6]||(e[6]=t=>F(i.value.pageSize)),class:"page-size-select"},e[27]||(e[27]=[l("option",{value:"5"},"5条/页",-1),l("option",{value:"10"},"10条/页",-1),l("option",{value:"20"},"20条/页",-1),l("option",{value:"50"},"50条/页",-1)]),544),[[z,i.value.pageSize]])]),S.value>1?(v(),r("div",ve,[l("button",{disabled:i.value.page<=1,onClick:e[7]||(e[7]=t=>I(i.value.page-1)),class:"pagination-btn"}," 上一页 ",8,pe),(v(!0),r(x,null,$(P(),(t,a)=>(v(),r(x,{key:a},[t==="..."?(v(),r("span",ce,"...")):(v(),r("button",{key:1,class:T(["pagination-btn",{active:t===i.value.page}]),onClick:$e=>I(t)},u(t),11,fe))],64))),128)),l("button",{disabled:i.value.page>=S.value,onClick:e[8]||(e[8]=t=>I(i.value.page+1)),class:"pagination-btn"}," 下一页 ",8,ge)])):h("",!0)])]),V.value?(v(),r("div",{key:0,class:"modal-overlay",onClick:_},[l("div",{class:"modal-container",onClick:e[16]||(e[16]=U(()=>{},["stop"]))},[l("div",{class:"modal-header"},[e[28]||(e[28]=l("h3",null,"编辑文章",-1)),l("button",{onClick:_,class:"modal-close"},"×")]),l("div",be,[l("div",me,[l("div",ye,[e[29]||(e[29]=l("label",null,"文章内容",-1)),d(l("textarea",{"onUpdate:modelValue":e[9]||(e[9]=t=>s.value.content=t),placeholder:"请输入文章内容...",rows:"6"},null,512),[[f,s.value.content]])]),l("div",ke,[e[30]||(e[30]=l("label",null,"位置信息",-1)),d(l("input",{type:"text","onUpdate:modelValue":e[10]||(e[10]=t=>s.value.location=t),placeholder:"输入位置信息"},null,512),[[f,s.value.location]])]),l("div",Ce,[l("div",he,[e[32]||(e[32]=l("label",null,"文章类型",-1)),d(l("select",{"onUpdate:modelValue":e[11]||(e[11]=t=>s.value.type=t)},e[31]||(e[31]=[l("option",{value:0},"文本文章",-1),l("option",{value:1},"图片文章",-1),l("option",{value:2},"视频文章",-1)]),512),[[z,s.value.type]])]),l("div",we,[e[35]||(e[35]=l("label",null,"文章设置",-1)),l("div",_e,[l("label",xe,[d(l("input",{type:"checkbox","onUpdate:modelValue":e[12]||(e[12]=t=>s.value.isTop=t)},null,512),[[B,s.value.isTop]]),e[33]||(e[33]=y(" 置顶文章 "))]),l("label",Ie,[d(l("input",{type:"checkbox","onUpdate:modelValue":e[13]||(e[13]=t=>s.value.isAd=t)},null,512),[[B,s.value.isAd]]),e[34]||(e[34]=y(" 推广内容 "))])])])]),s.value.type===1?(v(),r("div",Se,[e[36]||(e[36]=l("label",null,"图片链接",-1)),d(l("textarea",{"onUpdate:modelValue":e[14]||(e[14]=t=>b.value=t),placeholder:"输入图片链接，一行一个链接",rows:"3"},null,512),[[f,b.value]])])):h("",!0),s.value.type===2?(v(),r("div",Ve,[e[37]||(e[37]=l("label",null,"视频链接",-1)),d(l("textarea",{"onUpdate:modelValue":e[15]||(e[15]=t=>m.value=t),placeholder:"输入视频链接，一行一个链接",rows:"3"},null,512),[[f,m.value]])])):h("",!0)])]),l("div",De,[l("button",{onClick:_,class:"modal-cancel-btn"},"取消"),l("button",{onClick:L,disabled:k.value.saving,class:"modal-save-btn"},u(k.value.saving?"保存中...":"保存"),9,Ae)])])])):h("",!0),D.value?(v(),r("div",{key:1,class:"confirm-overlay",onClick:A},[l("div",{class:"confirm-dialog",onClick:e[18]||(e[18]=U(()=>{},["stop"]))},[l("div",Ue,[l("h3",null,u(C.value.title),1)]),l("div",ze,[e[38]||(e[38]=l("div",{class:"confirm-icon"},[l("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[l("path",{d:"M12 9V14M12 17.5H12.01M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z",stroke:"#f59e0b","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),l("p",null,u(C.value.message),1)]),l("div",Te,[l("button",{type:"button",onClick:A,class:"confirm-cancel-btn"},"取消"),l("button",{type:"button",onClick:e[17]||(e[17]=(...t)=>C.value.onConfirm&&C.value.onConfirm(...t)),class:"confirm-ok-btn"},"确定")])])])):h("",!0)],64))}}),Fe=K(Me,[["__scopeId","data-v-678b37d1"]]);export{Fe as default};
